---
title: 'Adding Secrets Manager to Lambda (Node.js)'
description: 'Securely pulling secrets into a Node.js Lambda using AWS SDK v3 and configuring access via SAM or CloudFormation.'
topics: ['Lambda', 'SecretsManager']
published: true
date: '2025-01-07'
---

## Overview

Secrets shouldn’t live in plaintext env variables. This is the flow I’ve been using to pull secrets into Lambda from AWS Secrets Manager.

## Node.js Code Snippet

Basic structure using AWS SDK v3. Works fine as long as the secret is stored as a JSON string.

```ts
import {
  SecretsManagerClient,
  GetSecretValueCommand,
} from '@aws-sdk/client-secrets-manager'

const SECRET_NAME = 'app-name-prod/some-secret'

const client = new SecretsManagerClient({ region: 'ap-northeast-1' })

export const getSecretsFromSecretManager = async () => {
  try {
    const response = await client.send(
      new GetSecretValueCommand({
        SecretId: SECRET_NAME,
        VersionStage: 'AWSCURRENT',
      }),
    )
    return JSON.parse(response.SecretString ?? '{}')
  } catch (err) {
    return JSON.stringify({ error: err }, null, 2)
  }
}
```

## SAM Setup

How access to Secrets Manager is configured using SAM. The key part is the policy block allowing `GetSecretValue` on the secret.

```yaml
SomeFunction:
  Type: AWS::Serverless::Function
  Properties:
    FunctionName: some-function-lambda
    Handler: app-lambda/dist/handlers/cachePurge.lambdaHandler
    Runtime: nodejs20.x
    Architectures:
      - x86_64
    Events:
      AkamaiCachePurgeApi:
        Type: Api
        Properties:
          RestApiId: !Ref Api
          Path: /some-endpoint
          Method: post
          Auth:
            ApiKeyRequired: true
    Policies:
      - Version: '2012-10-17'
        Statement:
          - Sid: SecretAccess
            Effect: Allow
            Action:
              - secretsmanager:GetSecretValue
            Resource: !Sub 'arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:${SecretName}-*'
```

## CloudFormation + IAM Role (Alternative)

Same policy, just structured inside an IAM Role. If not using SAM.

```yaml
Policies:
  - Version: '2012-10-17'
    Statement:
      - Sid: SecretAccess
        Effect: Allow
        Action:
          - secretsmanager:GetSecretValue
        Resource: !Sub 'arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:${SecretName}-*'
```

Attach this to the Lambda execution role.

## Notes

- Always check that secrets are stored as JSON
- Secrets Manager API has a default quota; keep an eye on usage if Lambdas get frequent traffic
- Might later automate rotation or versioning depending on how this evolves
