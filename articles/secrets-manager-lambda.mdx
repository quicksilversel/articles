---
title: 'How to Add Secrets Manager to Lambda (Node.js Edition)'
description: 'Let‚Äôs securely load secrets into your Lambda using AWS Secrets Manager ‚Äî with clean Node.js code and SAM/CloudFormation examples.'
topics: ['AWS', 'lambda', 'secretsmanager']
category: 'sre'
published: true
date: '2025-01-07'
---

## Introduction

> Psst... storing secrets in environment variables isn‚Äôt cool anymore. Let‚Äôs do it the secure way.

In this post, I‚Äôll show you how to:

1. Retrieve secrets in a Node.js Lambda using AWS SDK v3
2. Add permissions for Secrets Manager in SAM
3. (Bonus) Do it with CloudFormation + IAM Role

Let‚Äôs dive in üèÑ‚Äç‚ôÄÔ∏è

## üß† The Node.js Code

Here‚Äôs the full snippet you can use in your Lambda to fetch secrets securely:

```ts
import {
  SecretsManagerClient,
  GetSecretValueCommand,
} from '@aws-sdk/client-secrets-manager'

const SECRET_NAME = 'app-name-prod/cache-purge-secret' // Replace this with your secret name!

const client = new SecretsManagerClient({ region: 'ap-northeast-1' })

export const getSecretsFromSecretManager = async () => {
  try {
    const response = await client.send(
      new GetSecretValueCommand({
        SecretId: SECRET_NAME,
        VersionStage: 'AWSCURRENT',
      }),
    )
    return JSON.parse(response.SecretString ?? '{}')
  } catch (err) {
    return JSON.stringify({ error: err }, null, 2)
  }
}
```

> üßº Make sure your secret is stored as a JSON string in Secrets Manager.

## üèóÔ∏è Add Secrets Manager Access in SAM

Here‚Äôs how to wire everything up with [AWS SAM](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html):

```yaml
AkamaiCachePurgeFunction:
  Type: AWS::Serverless::Function
  Properties:
    FunctionName: some-app-lambda
    Handler: app-lambda/dist/handlers/cachePurge.lambdaHandler
    Runtime: nodejs20.x
    Architectures:
      - x86_64
    Events:
      AkamaiCachePurgeApi:
        Type: Api
        Properties:
          RestApiId: !Ref Api
          Path: /some-endpoint
          Method: post
          Auth:
            ApiKeyRequired: true
    Policies:
      - Version: '2012-10-17'
        Statement:
          - Sid: SecretAccess
            Effect: Allow
            Action:
              - secretsmanager:GetSecretValue
            Resource: !Sub 'arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:${SecretName}-*'
```

## üéì Bonus: CloudFormation + IAM Role

Prefer wiring things with raw CloudFormation + IAM Roles? You can attach a Secrets Manager policy like this:

```yaml
Policies:
  - Version: '2012-10-17'
    Statement:
      - Sid: SecretAccess
        Effect: Allow
        Action:
          - secretsmanager:GetSecretValue
        Resource: !Sub 'arn:aws:secretsmanager:${AWS::Region}:${AWS::AccountId}:secret:${SecretName}-*'
```

Then attach this IAM role to your Lambda.

## ‚úÖ That‚Äôs a Wrap!

You now know:

- How to use AWS SDK v3 to retrieve secrets in Node.js
- How to grant access using SAM or plain CFN
- Where to inject `SECRET_NAME`

This setup helps you keep secrets out of code and out of plaintext env variables.

Got questions or want to share your setup? Let me know!

Happy (secret) coding üïµÔ∏è‚Äç‚ôÇÔ∏è
